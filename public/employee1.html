<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenga Expense Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* --- Expenga.OS Color Palette --- */
        :root {
            --primary-bg: #0A0718; /* Near-black background */
            --secondary-bg: #1A1530; /* Darker card/container background */
            --primary-text: #EBEBFF; /* Off-white text */
            --accent-purple: #6A5ACD; /* Deep purple for buttons/accents */
            --accent-neon: #7F00FF; /* Neon purple for glow/highlights */
            --accent-cyan: #00FFFF; /* Bright cyan for 'MOST POPULAR' highlight/borders */
            --border-color: #332E4D; /* Subtle border color */
            --font-family-sans: 'Inter', sans-serif;
            --header-logo-color: #00FFFF;
        }

        /* --- Global Reset and Base Style --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--primary-text);
            font-family: var(--font-family-sans);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1300px; /* Increased max width */
            margin: 0 auto;
            padding: 30px;
            background-color: var(--secondary-bg);
            border-radius: 12px; /* Softer corners */
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5); /* Deep shadow */
            border: 1px solid var(--border-color); /* Subtle outer border */
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Header, Tabs, and Right Menu --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 15px;
        }

        .tab-button {
            background-color: transparent;
            border: none;
            color: var(--primary-text);
            padding: 10px 15px;
            cursor: pointer;
            font-family: var(--font-family-sans);
            font-size: 1.0em;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button:after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -2px;
            width: 100%;
            height: 2px;
            background-color: transparent;
            transition: background-color 0.3s ease;
        }

        .tab-button:hover {
            color: var(--accent-neon);
        }

        .tab-button.active {
            color: var(--accent-cyan);
            font-weight: 700;
        }

        .tab-button.active:after {
            background-color: var(--accent-cyan);
        }

        .right-menu {
            display: flex;
            gap: 10px;
        }

        .menu-item {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 0.9em;
            font-weight: 600;
            color: var(--primary-text);
            box-shadow: 0 0 10px rgba(127, 0, 255, 0.4); /* Neon shadow for depth */
            transition: transform 0.2s;
        }

        .menu-item:hover {
            transform: scale(1.1) rotate(5deg);
        }

        /* --- Workflow Bar (Aesthetic Progress Tracker) --- */
        .workflow-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
            margin-bottom: 30px;
            border-radius: 8px;
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1); /* Subtle cyan glow */
        }

        .status-step {
            text-align: center;
            padding: 0 25px;
            flex-grow: 1;
            opacity: 0.4;
            transition: opacity 0.3s;
        }

        .status-step.active-step {
            opacity: 1;
            font-weight: 600;
            transform: scale(1.05);
        }

        .status-step p:first-child {
            margin-bottom: 4px;
            font-size: 1.2em;
            color: var(--accent-cyan); /* Highlight the amount */
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.4);
        }

        .status-step p:last-child {
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--primary-text);
        }

        .arrow-line {
            font-size: 1.8em;
            color: var(--accent-purple);
            font-weight: 300;
            flex-shrink: 0;
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.6; }
        }

        /* --- Table Styling (Modern, Clean) --- */
        .table-container {
            padding-top: 15px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--primary-bg);
            border-bottom: 3px solid var(--accent-neon); /* Neon line for header */
            font-weight: 700;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Alternating row color for legibility */
        tbody tr:nth-child(even) {
            background-color: rgba(26, 21, 48, 0.5); /* Slightly darker even rows */
        }

        /* Hover effect on rows for better UX */
        tbody tr:hover {
            background-color: rgba(127, 0, 255, 0.15); /* Subtle neon purple hover */
            cursor: pointer;
            box-shadow: inset 2px 0 0 var(--accent-neon);
        }
        
        /* Status Badges */
        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            font-size: 0.85em;
            transition: all 0.3s;
            cursor: pointer; /* Ensure clickability is obvious */
        }

        .status:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .draft {
            background-color: rgba(255, 193, 7, 0.15); /* Yellow background */
            color: #FFC107; /* Yellow text */
        }

        .submitted {
            background-color: rgba(76, 175, 80, 0.15); /* Green background */
            color: #4CAF50; /* Green text */
        }
        
        /* Custom styles for Pending (used in JS) */
        .pending {
            background-color: rgba(255, 165, 0, 0.15);
            color: orange;
        }

        /* ⭐ NEW STYLE: Approved Status */
        .approved {
            background-color: rgba(0, 255, 255, 0.15); /* Light cyan background */
            color: #00FFFF; /* Bright cyan text (matches workflow bar accent) */
        }

        /* Modal Styling (for upload success) */
        .modal-content {
            box-shadow: 0 0 20px var(--accent-neon) !important;
            border: 2px solid var(--accent-cyan) !important;
            background-color: var(--secondary-bg) !important;
            color: var(--accent-cyan) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="tabs">
                <button class="tab-button" id="upload-tab">Upload</button>
                <button class="tab-button active" id="new-tab">New</button>
            </div>
            <div class="right-menu">
                <span class="menu-item" style="background-color: #9C27B0;">C</span>
                <span class="menu-item" style="background-color: #FF9800;">S</span>
                <span class="menu-item" style="background-color: #4CAF50;">G</span>
                <span class="menu-item" style="background-color: #2196F3;">D</span>
                <span class="menu-item" style="background-color: #E91E63;">D</span>
                <span class="menu-item" style="background-color: #03A9F4;">E</span>
                <span class="menu-item" style="background-color: #FFC107;">O</span>
            </div>
        </div>

        <div class="workflow-bar">
            <div class="status-step">
                <p>5467 rs</p>
                <p>To submit.</p>
            </div>
            <span class="arrow-line">→</span>
            <div class="status-step active-step">
                <p>33674 rs</p>
                <p>Waiting approval</p>
            </div>
            <span class="arrow-line">→</span>
            <div class="status-step">
                <p>500 rs</p>
                <p>Approved</p>
            </div>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th class="employee-col">Employee</th>
                        <th class="description-col">Description</th>
                        <th class="date-col">Date</th>
                        <th class="category-col">Category</th>
                        <th class="paidby-col">Paid By</th>
                        <th class="remarks-col">Remarks</th>
                        <th class="amount-col">Amount</th>
                        <th class="status-col">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="row-1">
                        <td class="employee-col">Cheery Lark</td>
                        <td class="description-col">Honorable Buffalo</td>
                        <td class="date-col">2025-10-01</td>
                        <td class="category-col">Travel</td>
                        <td class="paidby-col">Company</td>
                        <td class="remarks-col">Flight to Berlin</td>
                        <td class="amount-col">1200 $</td>
                        <td class="status-col"><span class="status draft" data-status="Draft">Draft</span></td>
                    </tr>
                    <tr id="row-2">
                        <td class="employee-col">Sarah</td>
                        <td class="description-col">Restaurant Dinner</td>
                        <td class="date-col">2025-09-28</td>
                        <td class="category-col">Food</td>
                        <td class="paidby-col">Sarah</td>
                        <td class="remarks-col">Client meeting</td>
                        <td class="amount-col">5000 rs</td>
                        <td class="status-col"><span class="status submitted" data-status="Submitted">Submitted</span></td>
                    </tr>
                    <tr id="row-3">
                        <td class="employee-col">Bouncy Dinosaur</td>
                        <td class="description-col">Excited Oyster</td>
                        <td class="date-col">2025-09-25</td>
                        <td class="category-col">Software</td>
                        <td class="paidby-col">Crow</td>
                        <td class="remarks-col">Subscription renewal</td>
                        <td class="amount-col">89 €</td>
                        <td class="status-col"><span class="status pending" data-status="Pending">Pending</span></td>
                    </tr>
                    <tr id="row-4">
                        <td class="employee-col">Alice Johnson</td>
                        <td class="description-col">Office Supplies</td>
                        <td class="date-col">2025-09-20</td>
                        <td class="category-col">Admin</td>
                        <td class="paidby-col">Company</td>
                        <td class="remarks-col">Ink and paper</td>
                        <td class="amount-col">50 $</td>
                        <td class="status-col"><span class="status submitted" data-status="Submitted">Submitted</span></td>
                    </tr>
                    <tr id="row-5">
                        <td class="employee-col">David Lee</td>
                        <td class="description-col">Hotel stay (Tokyo)</td>
                        <td class="date-col">2025-09-15</td>
                        <td class="category-col">Travel</td>
                        <td class="paidby-col">David Lee</td>
                        <td class="remarks-col">Client trip</td>
                        <td class="amount-col">80000 ¥</td>
                        <td class="status-col"><span class="status draft" data-status="Draft">Draft</span></td>
                    </tr>
                    <tr id="row-6">
                        <td class="employee-col">Daniel S.</td>
                        <td class="description-col">Marketing Ad Spend</td>
                        <td class="date-col">2025-09-10</td>
                        <td class="category-col">Marketing</td>
                        <td class="paidby-col">Company</td>
                        <td class="remarks-col">Q3 Campaign</td>
                        <td class="amount-col">1500 $</td>
                        <td class="status-col"><span class="status approved" data-status="Approved">Approved</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Flag to check if there is new data to be "uploaded"
            window.hasUnsubmittedData = false; 

            // --- Helper function to create a new row element ---
            function createNewRow(data) {
                const tableBody = document.querySelector('table tbody');
                if (!tableBody) {
                    console.error("Table body not found.");
                    return;
                }

                const statusText = 'Submitted';
                const statusClass = statusText.toLowerCase();

                const row = document.createElement('tr');
                row.classList.add('new-submission-item'); 
                
                row.innerHTML = `
                    <td class="employee-col">${data.employee || 'N/A'}</td> 
                    <td class="description-col">${data.description || 'N/A'}</td>
                    <td class="date-col">${data.expenseDate || 'N/A'}</td>
                    <td class="category-col">${data.category || 'N/A'}</td>
                    <td class="paidby-col">${data.paidBy || 'N/A'}</td>
                    <td class="remarks-col">${data.remarks || ''}</td>
                    <td class="amount-col">${data.totalAmount || '0'} ${data.currency || '$'}</td>
                    <td class="status-col">
                        <span class="status ${statusClass}" data-status="${statusText}">
                            ${statusText}
                        </span>
                    </td>
                `;
                
                // Prepend the new row to the table body (adds it to the top)
                tableBody.prepend(row);
                window.hasUnsubmittedData = true; 

                // Re-attach status click listener to the new row's status element
                const newStatusEl = row.querySelector('.status');
                if (newStatusEl) {
                    newStatusEl.addEventListener('click', handleStatusClick);
                }
            }

            // --- Status Click Handler (for existing and new rows) ---
            function handleStatusClick(event) {
                const statusEl = event.currentTarget;
                let currentStatus = statusEl.dataset.status;
                let newStatus;
                let newClass;

                // Define the status flow: Draft ↔ Submitted/Pending → Approved
                if (currentStatus === 'Draft') {
                    newStatus = 'Submitted';
                    newClass = 'submitted';
                } else if (currentStatus === 'Submitted' || currentStatus === 'Pending') {
                    // ⭐ CRITICAL CHANGE: If current is Submitted or Pending, the next click sets it to Approved.
                    newStatus = 'Approved';
                    newClass = 'approved'; 
                } else if (currentStatus === 'Approved') {
                    // Option: Allow 'Approved' to be reverted to 'Pending' if needed, but for simplicity, we'll stop the flow once Approved.
                    return; 
                } else {
                    return; 
                }

                // Update the element's appearance
                statusEl.textContent = newStatus;
                statusEl.dataset.status = newStatus;
                
                // Clean up old classes and add the new one
                statusEl.classList.remove('draft', 'submitted', 'pending', 'approved');
                statusEl.classList.add(newClass);
            }
            
            // Attach listener to all existing status elements
            document.querySelectorAll('.status').forEach(statusEl => {
                statusEl.addEventListener('click', handleStatusClick);
            });
            
            // --- Tab Switching & Navigation Logic ---
            const uploadTab = document.querySelector('.tab-button#upload-tab');
            const newTab = document.querySelector('.tab-button#new-tab');

            if (uploadTab && newTab) {
                // 1. New Tab: Redirects to the form page (employee2.html)
                newTab.addEventListener('click', () => {
                    window.location.href = 'employee2.html';
                });

                // 2. Upload Tab: Shows the success modal and handles data submission
                uploadTab.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(t => t.classList.remove('active'));
                    uploadTab.classList.add('active'); 
                    
                    showUploadSuccessModal();
                    
                    // Logic to visually mark new items as processed (changing status to 'Pending')
                    if (window.hasUnsubmittedData) {
                        document.querySelectorAll('.new-submission-item .status').forEach(statusEl => {
                            if (statusEl.dataset.status === 'Submitted') {
                                statusEl.textContent = 'Pending';
                                statusEl.dataset.status = 'Pending';
                                statusEl.classList.remove('submitted');
                                statusEl.classList.add('pending'); 
                            }
                        });
                        window.hasUnsubmittedData = false;
                    }
                    
                    // After processing, switch back to 'New' tab visually after a short delay
                    setTimeout(() => {
                        uploadTab.classList.remove('active');
                        newTab.classList.add('active');
                    }, 500); 
                });
            }

            /**
             * Shows the custom upload success message modal.
             */
            function showUploadSuccessModal() {
                let modalOverlay = document.querySelector('.modal-overlay');
                if (!modalOverlay) {
                    modalOverlay = document.createElement('div');
                    modalOverlay.className = 'modal-overlay';
                    modalOverlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:1000;';
                    modalOverlay.innerHTML = `
                        <div class="modal-content" style="background-color:var(--secondary-bg);border:1px solid var(--accent-cyan);border-radius:8px;padding:40px 60px;text-align:center;font-size:1.4em;font-weight:700;color:var(--accent-cyan);box-shadow:0 0 20px var(--accent-neon);">
                            🚀 Your details have been successfully uploaded!
                        </div>
                    `;
                    document.body.appendChild(modalOverlay);
                }
                modalOverlay.style.display = 'flex';

                setTimeout(() => {
                    modalOverlay.style.display = 'none';
                }, 3000);
            }


            // --- Data Processing from URL Parameters (On Load) ---
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('submitted')) {
                const formData = {
                    employee: urlParams.get('employee'),
                    description: urlParams.get('description'),
                    expenseDate: urlParams.get('expenseDate'),
                    category: urlParams.get('category'),
                    paidBy: urlParams.get('paidBy'),
                    remarks: urlParams.get('remarks'),
                    totalAmount: urlParams.get('totalAmount'),
                    currency: urlParams.get('currency'),
                };
                
                createNewRow(formData);
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
    </script>
</body>
</html>
